import 'package:flutter/material.dart';
import 'package:flutter_google_maps_3d_pins/data/notifier.dart';
import 'package:flutter_google_maps_3d_pins/googlemap_overlay.dart';
import 'package:flutter_google_maps_3d_pins/route.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';

void main() {
  runApp(
    const ProviderScope(
      child: MyApp(),
    ),
  );
}

class MyApp extends ConsumerWidget {
  const MyApp({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    Future.microtask(() => _initializeRoutes(ref));
    return MaterialApp(
      title: 'Flutter Demo',
      theme: ThemeData(
        colorScheme: ColorScheme.fromSeed(seedColor: Colors.deepPurple),
        useMaterial3: true,
      ),
      home: MapWithOverlay(),
    );
  }

  void _initializeRoutes(WidgetRef ref) {
    final notifier = ref.read(runningStateProvider.notifier);

    String jsonString = _loadJsonString();
    List<DetailedRoute> routes = parseRoutes(jsonString);

    notifier.initializeRoutes(routes);
  }

  String _loadJsonString() {
    return '''
[
  {
    "detailed_route": [
      [
        45.52487,
        -122.62454,
        75.96375652728398
      ],
      [
        45.52488,
        -122.6245,
        90.0
      ],
      [
        45.52488,
        -122.6245,
        20.224859429877256
      ],
      [
        45.52507,
        -122.62443,
        5.71059313911195
      ],
      [
        45.52517,
        -122.62442,
        350.5376777886735
      ],
      [
        45.52523,
        -122.62443,
        341.56505118318466
      ],
      [
        45.52529,
        -122.62445,
        341.5650511716498
      ],
      [
        45.52538,
        -122.62448,
        329.036243472716
      ],
      [
        45.52548,
        -122.62454,
        329.0362434607422
      ],
      [
        45.52553,
        -122.62457,
        308.65980826004784
      ],
      [
        45.52557,
        -122.62462,
        306.86989763281645
      ],
      [
        45.5256,
        -122.62466,
        306.8698976491009
      ],
      [
        45.52563,
        -122.6247,
        315.00000000678517
      ],
      [
        45.52566,
        -122.62473,
        321.842773409934
      ],
      [
        45.5258,
        -122.62484,
        327.52880771298317
      ],
      [
        45.52591,
        -122.62491,
        333.43494882408515
      ],
      [
        45.52605,
        -122.62498,
        336.8014094800346
      ],
      [
        45.52612,
        -122.62501,
        352.87498364921925
      ],
      [
        45.5262,
        -122.62502,
        353.15722658826803
      ],
      [
        45.52645,
        -122.62505,
        0.0
      ],
      [
        45.5265,
        -122.62505,
        0.0
      ],
      [
        45.52658,
        -122.62505,
        0.0
      ],
      [
        45.5266,
        -122.62505,
        14.036243472716023
      ],
      [
        45.52668,
        -122.62503,
        9.462322198122934
      ],
      [
        45.52674,
        -122.62502,
        18.43494882699315
      ],
      [
        45.52677,
        -122.62501,
        18.43494882699315
      ],
      [
        45.5268,
        -122.625,
        21.80140949196715
      ],
      [
        45.52685,
        -122.62498,
        0.0
      ],
      [
        45.52686,
        -122.62498,
        26.56505117436393
      ],
      [
        45.52692,
        -122.62495,
        44.99999997964443
      ],
      [
        45.52694,
        -122.62493,
        29.744881306963407
      ],
      [
        45.52701,
        -122.62489,
        0.0
      ],
      [
        45.52702,
        -122.62489,
        37.87498364859289
      ],
      [
        45.52711,
        -122.62482,
        33.690067532243006
      ],
      [
        45.52714,
        -122.6248,
        36.86989764258715
      ],
      [
        45.52718,
        -122.62477,
        45.000000003392586
      ],
      [
        45.52724,
        -122.62471,
        45.0
      ],
      [
        45.52737,
        -122.62458,
        50.19442890573259
      ],
      [
        45.52747,
        -122.62446,
        59.036243468724706
      ],
      [
        45.52756,
        -122.62431,
        66.0375110262612
      ],
      [
        45.52764,
        -122.62413,
        63.43494882059565
      ],
      [
        45.52771,
        -122.62399,
        72.64597536402846
      ],
      [
        45.52776,
        -122.62383,
        72.64597536257963
      ],
      [
        45.52781,
        -122.62367,
        73.30075576899435
      ],
      [
        45.52784,
        -122.62357,
        81.86989764258715
      ],
      [
        45.52785,
        -122.6235,
        80.53767779637559
      ],
      [
        45.52786,
        -122.62344,
        84.28940686088805
      ],
      [
        45.52788,
        -122.62324,
        90.0
      ],
      [
        45.52788,
        -122.62321,
        90.0
      ],
      [
        45.52788,
        -122.62314,
        90.0
      ]
    ]
  },
  {
    "detailed_route": [
      [
        45.52645,
        -122.62505,
        91.00508600486586
      ],
      [
        45.52644,
        -122.62448,
        90.0
      ],
      [
        45.52644,
        -122.62383,
        101.821488340776
      ],
      [
        45.52635,
        -122.6234,
        90.0
      ],
      [
        45.52635,
        -122.6234,
        146.309932467757
      ],
      [
        45.52632,
        -122.62338,
        135.00000001017776
      ],
      [
        45.5263,
        -122.62336,
        153.43494881477977
      ],
      [
        45.52628,
        -122.62335,
        123.69006752911139
      ],
      [
        45.52626,
        -122.62332,
        134.9999999898222
      ],
      [
        45.52624,
        -122.6233,
        123.69006752911139
      ],
      [
        45.52622,
        -122.62327,
        134.9999999898222
      ],
      [
        45.5262,
        -122.62325,
        108.43494883106422
      ],
      [
        45.52619,
        -122.62322,
        108.43494882088646
      ],
      [
        45.52617,
        -122.62316,
        101.30993247715185
      ],
      [
        45.52616,
        -122.62311,
        99.46232220582499
      ],
      [
        45.52615,
        -122.62305,
        101.30993247715185
      ],
      [
        45.52614,
        -122.623,
        80.5376777897738
      ],
      [
        45.52615,
        -122.62294,
        90.0
      ],
      [
        45.52615,
        -122.62288,
        78.6900675306772
      ],
      [
        45.52616,
        -122.62283,
        66.0375110224839
      ],
      [
        45.5262,
        -122.62274,
        63.434948822922024
      ],
      [
        45.52621,
        -122.62272,
        90.0
      ],
      [
        45.52621,
        -122.62271,
        63.43494880663758
      ],
      [
        45.52622,
        -122.62269,
        45.00000002035557
      ],
      [
        45.52623,
        -122.62268,
        45.0
      ],
      [
        45.52624,
        -122.62267,
        63.43494883920647
      ],
      [
        45.52625,
        -122.62265,
        26.565051152651336
      ],
      [
        45.52627,
        -122.62264,
        45.0
      ],
      [
        45.52628,
        -122.62263,
        38.6598082521042
      ],
      [
        45.52633,
        -122.62259,
        26.565051185220227
      ],
      [
        45.52637,
        -122.62257,
        14.036243472716023
      ],
      [
        45.52641,
        -122.62256,
        0.0
      ],
      [
        45.52645,
        -122.62256,
        0.0
      ],
      [
        45.52649,
        -122.62256,
        345.963756527284
      ],
      [
        45.52653,
        -122.62257,
        333.4349488147798
      ],
      [
        45.52657,
        -122.62259,
        326.3099324865467
      ],
      [
        45.5266,
        -122.62261,
        303.6900675165849
      ],
      [
        45.52662,
        -122.62264,
        315.0000000101778
      ],
      [
        45.52664,
        -122.62266,
        303.6900675165849
      ],
      [
        45.52666,
        -122.62269,
        303.6900675291114
      ],
      [
        45.52668,
        -122.62272,
        303.6900675291114
      ],
      [
        45.5267,
        -122.62275,
        296.565051177078
      ],
      [
        45.52672,
        -122.62279,
        325.4077113115715
      ],
      [
        45.52701,
        -122.62299,
        0.0
      ],
      [
        45.52717,
        -122.62299,
        90.0
      ],
      [
        45.52717,
        -122.62299,
        90.0
      ],
      [
        45.52717,
        -122.62173,
        90.0
      ],
      [
        45.52717,
        -122.62105,
        90.0
      ]
    ]
  },
  {
    "detailed_route": [
      [
        45.52651,
        -122.61882,
        173.6598082521042
      ],
      [
        45.52642,
        -122.61881,
        90.0
      ],
      [
        45.52642,
        -122.61881,
        269.5452811381633
      ],
      [
        45.52641,
        -122.62007,
        270.72522429929404
      ],
      [
        45.52642,
        -122.62086,
        271.43209618355434
      ],
      [
        45.52643,
        -122.62126,
        270.0
      ],
      [
        45.52643,
        -122.62208,
        284.0362434687247
      ],
      [
        45.52649,
        -122.62232,
        289.65382405584273
      ],
      [
        45.52654,
        -122.62246,
        291.8014094891595
      ],
      [
        45.5266,
        -122.62261,
        90.0
      ],
      [
        45.5266,
        -122.62261,
        303.6900675165849
      ],
      [
        45.52662,
        -122.62264,
        315.0000000101778
      ],
      [
        45.52664,
        -122.62266,
        303.6900675165849
      ],
      [
        45.52666,
        -122.62269,
        303.6900675291114
      ],
      [
        45.52668,
        -122.62272,
        303.6900675291114
      ],
      [
        45.5267,
        -122.62275,
        296.565051177078
      ],
      [
        45.52672,
        -122.62279,
        325.4077113115715
      ],
      [
        45.52701,
        -122.62299,
        0.0
      ],
      [
        45.52717,
        -122.62299,
        0.0
      ],
      [
        45.52789,
        -122.62299,
        359.1930705446392
      ],
      [
        45.5286,
        -122.623,
        90.0
      ],
      [
        45.5286,
        -122.623,
        267.7974018390761
      ],
      [
        45.52859,
        -122.62326,
        267.70938995658105
      ],
      [
        45.52858,
        -122.62351,
        270.0
      ],
      [
        45.52858,
        -122.62355,
        259.21570213332825
      ],
      [
        45.52854,
        -122.62376,
        256.60750224555
      ],
      [
        45.52849,
        -122.62397,
        253.39301942154407
      ],
      [
        45.52832,
        -122.62454,
        90.0
      ],
      [
        45.52832,
        -122.62454,
        320.9061411142494
      ],
      [
        45.52848,
        -122.62467,
        321.0090059550407
      ],
      [
        45.52869,
        -122.62484,
        321.0090059550407
      ]
    ]
  }
]

''';
  }
}
